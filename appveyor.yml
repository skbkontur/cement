skip_branch_with_pr: true
version: '{build}-{branch}'
image: Visual Studio 2022
install:
  - cd %APPVEYOR_BUILD_FOLDER%
  - git submodule update --init
  - nuget restore
configuration: Debug
before_build:
  - git config --global user.email johndoe@example.com
build:
  verbosity: normal
  project: Cement.Net.sln
after_build:
  - mkdir dotnet
  - cd Cement.Net
  - if not exist ..\files-common\win10-x64 mkdir ..\files-common\win10-x64
  - dotnet publish -r win10-x64 -o ..\files-common\win10-x64 /p:PublishSingleFile=true /p:DebugType=None --self-contained true
  - if not exist ..\files-common\linux-x64 mkdir ..\files-common\linux-x64
  - dotnet publish -r linux-x64 -o ..\files-common\linux-x64 /p:PublishSingleFile=true /p:DebugType=None --self-contained true
  - if not exist ..\files-common\osx-x64 mkdir ..\files-common\osx-x64
  - dotnet publish -r osx-x64 -o ..\files-common\osx-x64 /p:PublishSingleFile=true /p:DebugType=None --self-contained true
  - copy ..\files-common\win10-x64\cm.exe ..\files-common\cm_new.exe
  - cd %APPVEYOR_BUILD_FOLDER%
  - xcopy files-common dotnet /s /i /Y
  - 7z a %APPVEYOR_REPO_COMMIT%.zip dotnet
artifacts:
  - path: $(appveyor_repo_commit).zip
deploy:
  provider: GitHub
  description: automatic release
  artifact: $(appveyor_repo_commit).zip
  auth_token:
    secure: IohH0lniXT8rX6Z5YVGV52bgpi4ZK8t92aD8a2HcBQ6P/+PQvqjE9r5kMCgWb15z
  on:
    appveyor_repo_tag: true
